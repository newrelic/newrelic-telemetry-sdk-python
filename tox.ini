[tox]
envlist =
    {py37,py38,py39,py310,py311,py312,pypy3.10}-urllib3_{v1,v2}
    lint
    docs

[testenv]
commands = pytest --cov {posargs}
passenv =
    NEW_RELIC_LICENSE_KEY
deps =
    # Base Dependencies
    pytest
    pytest-cov
    # Test Suite Dependencies
    urllib3_v1: urllib3<2
    urllib3_v2: urllib3>=2,<3

[testenv:lint]
skip_install = True
commands =
    black --check src/ docs/ tests/ {posargs}
    flake8 src/ tests/ {posargs}
deps =
    black
    flake8

[testenv:docs]
commands = sphinx-build -d "{toxinidir}/docs_doctree" "{toxinidir}/docs/" "{toxinidir}/docs/_build" -W {posargs}
deps =
    sphinx<8
    sphinx_rtd_theme
